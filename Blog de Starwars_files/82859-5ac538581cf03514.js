"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[82859],{82859:function(n,l,e){var i=e(63176),o=e(15412),t=e(93502),r=e(92697),a=e(12509),d=e(58653),u=e(69574),p=e(22407),c=e(42278),s=e(1718),v=e(84666),_=e(9269);l.Z=()=>{let{isAuthenticated:n}=(0,v.Z)(),{userSession:l,location:e}=(0,s.Z)(),y=(0,i.v9)(n=>n.signupReducer),{setLoader:m,setCheckingData:h,setPaymentMethods:g,toggleIfEnrolled:f,setService:w,setSelfAppliedCoupon:P,setPaymentStatus:b,setIsSubmittingPayment:T,setDeclinedPayment:N}=(0,r.Z)(),[,E]=(0,c.K)("subscription-process",null),{t:A}=(0,o.Z)("signup"),{createToast:C}=(0,_.Z)({toastId:"error-payment-transaction"}),F=(0,t.useRouter)(),{locale:O}=F,I=(0,d.qn)("redirect"),R=(0,d.qn)("redirected-from"),M=(0,d.Wz)("coupons"),q=(0,d.Wz)("add_ons"),k=(0,d.Wz)("country_code"),S=(0,d.NT)(q),x=k||(null==e?void 0:e.countryShort),L={PREPARING_FOR_COHORT:"PREPARING_FOR_COHORT"},Y=(0,d.n4)(1).translation[O],{stepIndex:Z,checkingData:D,planData:B,selectedPlan:G,paymentStatus:H,isSubmittingPayment:U,selectedPlanAddons:$}=y,W="idle"===H,j={CONTACT:1,PAYMENT:2,SUMMARY:3},z=Z===j.CONTACT,Q=Z===j.PAYMENT,X=Z===j.SUMMARY,V={one_payment:A("signup:one_payment"),free_trial:A("signup:free_trial"),monthly_payment:A("signup:monthly_payment"),quarterly_payment:A("signup:quarterly_payment"),half_yearly_payment:A("signup:half_yearly_payment"),yearly_payment:A("signup:yearly_payment"),free:A("signup:free"),totally_free:A("signup:totally_free"),free_trial_period:(n,l)=>{let e=null==l?void 0:l.toLowerCase(),i={day:A("common:word-connector.day"),week:A("common:word-connector.week"),month:A("common:word-connector.month"),year:A("common:word-connector.year")},o={day:A("common:word-connector.days"),week:A("common:word-connector.weeks"),month:A("common:word-connector.months"),year:A("common:word-connector.years")},t=n>1?o[e]:i[e];return A("signup:info.free-trial-period",{qty:n,period:t})},one_payment_description:A("signup:one_payment_description"),monthly_payment_description:A("signup:monthly_payment_description"),quarterly_payment_description:A("signup:quarterly_payment_description"),half_yearly_payment_description:A("signup:half_yearly_payment_description"),yearly_payment_description:A("signup:yearly_payment_description"),checkout_featured_info:n=>A("signup:custom-plans-pricing.".concat(n,".checkout_features"),{},{returnObjects:!0}),financing_description:(n,l,e)=>A("signup:financing_many_months_description",{monthly_price:n,many_months:l,currency:e}),monthly:A("signup:info.monthly"),quarterly:A("signup:info.quarterly"),half_yearly:A("signup:info.half-yearly"),yearly:A("signup:info.yearly"),financing:A("signup:info.financing"),many_months_payment:n=>A("signup:many_months_payment",{qty:n})},processPlans=async function(n){let{monthly:l=!0,quarterly:e=!0,halfYearly:i=!0,yearly:o=!0,planType:t=""}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{var r,p,c,s,v,_,y,m,h,g,f,w;let P=encodeURIComponent(null==n?void 0:n.slug),b=await a.Z.payment({country_code:x}).getServiceItemsByPlan(P);if(!b)throw Error("The plan does not exist");let T=Array.isArray(V.checkout_featured_info(null==n?void 0:n.slug))?V.checkout_featured_info(null==n?void 0:n.slug):null==b?void 0:b.data,N=null==n?void 0:n.owner,E=(null==n?void 0:n.price_per_half)>0,A=(null==n?void 0:n.price_per_month)>0,C=(null==n?void 0:n.price_per_quarter)>0,F=(null==n?void 0:n.price_per_year)>0,O=E||A||C||F,I=(null==n?void 0:null===(r=n.financing_options)||void 0===r?void 0:r.length)>0,R=(null==n?void 0:null===(p=n.plans)||void 0===p?void 0:p.length)>0?null==n?void 0:null===(c=n.plans)||void 0===c?void 0:c[0]:n,M=!O&&(null==R?void 0:R.trial_duration)===0&&!I,k=O||M||(null==R?void 0:R.trial_duration_unit)>0,S=(null==n?void 0:null===(s=n.financing_options)||void 0===s?void 0:s.filter(n=>n.monthly_price>0&&n.how_many_months>1).sort((n,l)=>n.monthly_price-l.monthly_price))||[],L=(null==n?void 0:null===(v=n.financing_options)||void 0===v?void 0:v.filter(n=>(null==n?void 0:n.monthly_price)>0&&(null==n?void 0:n.how_many_months)===1))||[],Y={plan_slug:null==R?void 0:R.slug,currency:null==R?void 0:R.currency,featured_info:T,trial_duration:(null==R?void 0:R.trial_duration)||0,trial_duration_unit:(null==R?void 0:R.trial_duration_unit)||"",planType:t,show:!0,isFreeTier:!1,owner:N},Z={free:(null==V?void 0:V.free)||"Free",totally_free:(null==V?void 0:V.totally_free)||"Totally free",free_trial:(null==V?void 0:V.free_trial)||"Free trial",one_payment:(null==V?void 0:V.one_payment)||"One payment",monthly_payment:(null==V?void 0:V.monthly_payment)||"Monthly payment",quarterly_payment:(null==V?void 0:V.quarterly_payment)||"Quarterly payment",half_yearly_payment:(null==V?void 0:V.half_yearly_payment)||"Half yearly payment",yearly_payment:(null==V?void 0:V.yearly_payment)||"Yearly payment",many_months_payment:n=>(null==V?void 0:V.many_months_payment(n))||"Payment for ".concat(n," months"),label:{free_trial_period:(n,l)=>{let e=null==l?void 0:l.toLowerCase();return(null==V?void 0:V.free_trial_period(n,e))||"Free trial for ".concat(n," ").concat(e)},free:(null==V?void 0:V.free)||"Free",monthly:(null==V?void 0:V.monthly)||"Monthly",quarterly:(null==V?void 0:V.quarterly)||"Quarterly",half_yearly:(null==V?void 0:V.half_yearly)||"Half yearly",yearly:(null==V?void 0:V.yearly)||"Yearly",financing:(null==V?void 0:V.financing)||"Financing"}},D=M?Z.totally_free:Z.label.free_trial_period(null==R?void 0:R.trial_duration,null==R?void 0:R.trial_duration_unit),B=L.map(n=>{var l;return{...Y,title:Z.one_payment,price:null==n?void 0:n.monthly_price,priceText:"".concat(u.dB[null==n?void 0:null===(l=n.currency)||void 0===l?void 0:l.code]||"$").concat(null==n?void 0:n.monthly_price),period:"ONE_TIME",period_label:Z.one_payment,plan_id:"f-".concat(null==n?void 0:n.monthly_price,"-").concat(null==n?void 0:n.how_many_months),description:(null==V?void 0:V.one_payment_description)||"",how_many_months:null==n?void 0:n.how_many_months,type:"PAYMENT"}}),G=I||O?{}:{...Y,title:(null==R?void 0:R.title)?null==R?void 0:R.title:(0,d.I4)(String(null==R?void 0:R.slug)),price:0,priceText:M?Z.free:Z.free_trial,plan_id:"p-".concat(null==R?void 0:R.trial_duration,"-trial"),description:D,period:M?"FREE":null==R?void 0:R.trial_duration_unit,period_label:D,type:M?"FREE":"TRIAL",isFreeTier:!0},H=l&&A?{...Y,title:(null==R?void 0:R.title)?null==R?void 0:R.title:Z.monthly_payment,price:null==n?void 0:n.price_per_month,pricePerMonth:null==n?void 0:n.price_per_month,priceText:"".concat(u.dB[null==R?void 0:null===(_=R.currency)||void 0===_?void 0:_.code]||"$").concat(null==n?void 0:n.price_per_month),plan_id:"p-".concat(null==n?void 0:n.price_per_month),description:(null==V?void 0:V.yearly_payment_description)||"",period:"MONTH",period_label:Z.label.monthly,type:"PAYMENT"}:{},U=e&&C?{...Y,title:(null==R?void 0:R.title)?null==R?void 0:R.title:Z.quarterly_payment,price:null==n?void 0:n.price_per_quarter,pricePerMonth:(null==n?void 0:n.price_per_quarter)?(n.price_per_quarter/4).toFixed(2):0,pricePerMonthText:"".concat(u.dB[null==n?void 0:null===(y=n.currency)||void 0===y?void 0:y.code]||"$").concat((null==n?void 0:n.price_per_quarter)?(n.price_per_quarter/4).toFixed(2):0),priceText:"".concat(u.dB[null==n?void 0:null===(m=n.currency)||void 0===m?void 0:m.code]||"$").concat((null==n?void 0:n.price_per_quarter)||0),plan_id:"p-".concat((null==n?void 0:n.price_per_quarter)||0),description:(null==V?void 0:V.quarterly_payment_description)||"",period:"QUARTER",period_label:Z.label.quarterly,type:"PAYMENT",show:!1}:{},$=i&&E?{...Y,title:(null==R?void 0:R.title)?null==R?void 0:R.title:Z.half_yearly_payment,price:null==n?void 0:n.price_per_half,pricePerMonth:(null==n?void 0:n.price_per_half)?(n.price_per_half/6).toFixed(2):0,pricePerMonthText:"".concat(u.dB[null==n?void 0:null===(h=n.currency)||void 0===h?void 0:h.code]||"$").concat((null==n?void 0:n.price_per_half)?(n.price_per_half/6).toFixed(2):0),priceText:"".concat(u.dB[null==n?void 0:null===(g=n.currency)||void 0===g?void 0:g.code]||"$").concat((null==n?void 0:n.price_per_half)||0),plan_id:"p-".concat((null==n?void 0:n.price_per_half)||0),description:(null==V?void 0:V.half_yearly_payment_description)||"",period:"HALF",period_label:Z.label.half_yearly,type:"PAYMENT",show:!1}:{},W=o&&F?{...Y,title:(null==R?void 0:R.title)?null==R?void 0:R.title:Z.yearly_payment,price:null==n?void 0:n.price_per_year,pricePerMonth:(null==n?void 0:n.price_per_year)?(n.price_per_year/12).toFixed(2):0,pricePerMonthText:"".concat(u.dB[null==n?void 0:null===(f=n.currency)||void 0===f?void 0:f.code]||"$").concat((null==n?void 0:n.price_per_year)?(n.price_per_year/12).toFixed(2):0),priceText:"".concat(u.dB[null==n?void 0:null===(w=n.currency)||void 0===w?void 0:w.code]||"$").concat((null==n?void 0:n.price_per_year)||0),plan_id:"p-".concat((null==n?void 0:n.price_per_year)||0),description:(null==V?void 0:V.yearly_payment_description)||"",period:"YEAR",period_label:Z.label.yearly,type:"PAYMENT"}:{},j=S.map((n,l)=>{var e,i;let o=V.many_months_payment(null==n?void 0:n.how_many_months),t=null==V?void 0:V.financing_description(null==n?void 0:n.monthly_price,null==n?void 0:n.how_many_months,u.dB[null==n?void 0:null===(e=n.currency)||void 0===e?void 0:e.code]||"$");return{...Y,financingId:l+1,title:(null==R?void 0:R.title)?null==R?void 0:R.title:o,price:null==n?void 0:n.monthly_price,priceText:"".concat(u.dB[null==n?void 0:null===(i=n.currency)||void 0===i?void 0:i.code]||"$").concat(null==n?void 0:n.monthly_price," x ").concat(null==n?void 0:n.how_many_months),plan_id:"f-".concat(null==n?void 0:n.monthly_price,"-").concat(null==n?void 0:n.how_many_months),description:t||"",period:"FINANCING",period_label:Z.label.financing,how_many_months:null==n?void 0:n.how_many_months,type:"PAYMENT"}}),z=q&&"string"==typeof q?q.split(",").map(n=>n.trim()).filter(n=>n.length>0).map(n=>{let[l,e]=n.split(":"),i=Number(l),o=Number(e),t=Number.isFinite(o)&&o>0?o:1;return{addOnId:i,qty:t}}).filter(n=>Number.isFinite(n.addOnId)&&n.addOnId>0&&Number.isFinite(n.qty)&&n.qty>0):[],Q=((n,l)=>{let e=Array.isArray(null==n?void 0:n.add_ons)?n.add_ons:[];return e.length&&l.length?l.reduce((n,l)=>{let i=e.find(n=>(null==n?void 0:n.id)===l.addOnId);if(!i)return n;let o=Number(null==i?void 0:i.price_per_unit)||0;return n+o*l.qty},0):0})(n,z),applyAddOnsToPlan=l=>{var e,i;if(!l||0===Object.keys(l).length)return l;let o=u.dB[(null==l?void 0:null===(e=l.currency)||void 0===e?void 0:e.code)||(null==n?void 0:null===(i=n.currency)||void 0===i?void 0:i.code)]||"$",t=Number(null==l?void 0:l.how_many_months)||1;if(!Q)return l;let r=Number((null==l?void 0:l.price)||0)+Q,a={...l,price:r};return(null==l?void 0:l.period)==="FINANCING"?a.priceText="".concat(o).concat(r," x ").concat(t):a.priceText="".concat(o).concat(r),a},X=[G,B[0],W,$,U,H,...j].filter(n=>n&&Object.keys(n).length>0&&n.show),K=[B[0],W,H,G].filter(n=>n&&Object.keys(n).length>0),J=null==j?void 0:j.filter(n=>n&&Object.keys(n).length>0),nn=Q>0?X.map(applyAddOnsToPlan):X,nl=Q>0?K.map(applyAddOnsToPlan):K,ne=Q>0?J.map(applyAddOnsToPlan):J;return{...n,title:(null==n?void 0:n.title)||(0,d.rV)(null==n?void 0:n.slug),isTotallyFree:M,isTrial:!O&&!I,plans:nn,featured_info:T||[],paymentOptions:nl,financingOptions:ne,hasSubscriptionMethod:k}}catch(n){return console.error("Error processing plans:",n),n}},generatePlan=async n=>{try{let l=await a.Z.payment({country_code:x}).getPlan(n),e=await processPlans(null==l?void 0:l.data);return e}catch(n){return console.error("Error generating plan:",n),{}}},getSuggestedPlan=async function(n){var l,e;let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let{data:e}=await a.Z.payment({original_plan:n,country_code:x}).planOffer();if((null==e?void 0:e.length)===0)return null;let o=e[0];if(!i){let n=null==o?void 0:o.original_plan,e=null==o?void 0:o.suggested_plan,i=n.slug?await processPlans(n,{quarterly:!1,halfYearly:!1,planType:"original"}):{},t=e.slug?await processPlans(e,{quarterly:!1,halfYearly:!1,planType:"suggested"},V):{};return{plans:{original_plan:{...i,originData:n},suggested_plan:{...t,originData:e}},details:null==o?void 0:o.details,title:null==o?void 0:null===(l=o.details)||void 0===l?void 0:l.title}}return o}catch(n){return null==n?void 0:null===(e=n.response)||void 0===e?void 0:e.data}},handleSuggestedPlan=async function(n){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"default";try{var e,i,o,t,r,a,d,u,p,c;let s=await getSuggestedPlan(n);if("default"===l){if(!s||0===s.length){let l=await generatePlan(n);return{plans:{original_plan:l,suggested_plan:{}},details:{},title:(null==l?void 0:l.title)||"",planList:[...(null==l?void 0:l.plans)||[]]}}return{...s,planList:[...(null==s?void 0:null===(a=s.plans)||void 0===a?void 0:null===(r=a.original_plan)||void 0===r?void 0:r.plans)||[],...(null==s?void 0:null===(u=s.plans)||void 0===u?void 0:null===(d=u.suggested_plan)||void 0===d?void 0:d.plans)||[]]}}if("mkt_plans"===l){if(!s||0===s.length){let l=await generatePlan(n);return{...l,planList:(null==l?void 0:l.plans)||[],plans:{original_plan:l,suggested_plan:{}},details:{},title:(null==l?void 0:l.title)||""}}let l=(null===(p=s.plans)||void 0===p?void 0:p.original_plan)||{},e=(null===(c=s.plans)||void 0===c?void 0:c.suggested_plan)||{},i=(null==l?void 0:l.plans)||[],o=(null==e?void 0:e.plans)||[],t={planList:[...i,...o],plans:{original_plan:l,suggested_plan:e},slug:(null==e?void 0:e.slug)||l.slug||"",financingOptions:[...(null==l?void 0:l.financingOptions)||[],...(null==e?void 0:e.financingOptions)||[]],paymentOptions:[...(null==l?void 0:l.paymentOptions)||[],...(null==e?void 0:e.paymentOptions)||[]]};return t}return{...s,planList:[...(null==s?void 0:null===(i=s.plans)||void 0===i?void 0:null===(e=i.original_plan)||void 0===e?void 0:e.plans)||[],...(null==s?void 0:null===(t=s.plans)||void 0===t?void 0:null===(o=t.suggested_plan)||void 0===o?void 0:o.plans)||[]]}}catch(n){return console.error(n),{}}},validatePlanExistence=async function(n){let l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",e=l||u.T4;try{let l=await getSuggestedPlan(e,!0),i=null==l?void 0:l.original_plan,o=null==l?void 0:l.suggested_plan,t=n.some(n=>{var l,e;return(null==n?void 0:null===(e=n.plans)||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.slug)===(null==i?void 0:i.slug)}),r=n.some(n=>{var l,e;return(null==n?void 0:null===(e=n.plans)||void 0===e?void 0:null===(l=e[0])||void 0===l?void 0:l.slug)===(null==o?void 0:o.slug)});return{basePlan:i,suggestedPlan:o,hasBasePlan:t,hasASuggestedPlan:r,allSubscriptions:n}}catch(l){return{basePlan:{},suggestedPlan:{},hasBasePlan:!1,hasASuggestedPlan:!1,allSubscriptions:n}}},handlePayment=async function(n){let e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=(null==G?void 0:G.how_many_months)>0||(null==G?void 0:G.period)==="FINANCING",o=["FREE","TRIAL"].includes(null==G?void 0:G.type);try{var t,r,u;let c=o?{type:(null==n?void 0:n.type)||(null==D?void 0:D.type),token:(null==n?void 0:n.token)||(null==D?void 0:D.token)}:{type:(null==n?void 0:n.type)||(null==D?void 0:D.type),token:(null==n?void 0:n.token)||(null==D?void 0:D.token),how_many_installments:(null==n?void 0:n.installments)||(null==G?void 0:G.how_many_months)||void 0,chosen_period:i?void 0:(null==G?void 0:G.period)||"HALF",coupons:null==D?void 0:D.coupons,add_ons:((null==D?void 0:D.add_ons)||[]).filter(n=>S.includes(null==n?void 0:n.id)),payment_method:"stripe"},s=await a.Z.payment().pay({country_code:x,...c,conversion_info:{...l}}),v=s.data;if((null==v?void 0:v.status)==="FULFILLED"){E({status:L.PREPARING_FOR_COHORT});let n="USD",l=[];if(B){(null==B?void 0:null===(u=B.currency)||void 0===u?void 0:u.code)&&(n=B.currency.code);let{service_items:e,...i}=B;l=[{plan:i}]}let i=l.map(n=>({item_id:n.plan.slug,item_name:n.plan.slug,price:(null==v?void 0:v.amount)||0,quantity:1,item_category:"subscription",subscription_period:(null==G?void 0:G.period_label)||"one-time"}));(0,p._1)({dataLayer:{event:"purchase",transaction_id:null==v?void 0:v.id,value:(null==v?void 0:v.amount)||0,currency:n,payment_type:"Credit card",plan:(null==G?void 0:G.plan_slug)||(null==v?void 0:null===(r=v.plan)||void 0===r?void 0:r.slug)||"4geeks-basic-subscription",period_label:(null==G?void 0:G.period_label)||"one-time",items:i,agent:(0,d.S7)()}}),e||(I&&(null==I?void 0:I.length)>0||R&&R.length>0?(F.push(I||R),localStorage.removeItem("redirect"),localStorage.removeItem("redirected-from")):F.push("/choose-program")),(void 0===v||v.status>=400)&&C({position:"top",title:A("alert-message:payment-error"),status:"error",duration:7e3,isClosable:!0})}let _=await a.Z.payment().getMyCoupon();return(null==_?void 0:null===(t=_.data)||void 0===t?void 0:t.length)>0&&(0,p._1)({dataLayer:{event:"plan_coupon_create",coupon_data:null==_?void 0:_.data[0]}}),v}catch(n){return console.error("Error handling payment bc.payment().pay",n),n}},handleCoinbasePayment=async()=>{let n=(null==G?void 0:G.how_many_months)>0||(null==G?void 0:G.period)==="FINANCING",e=["FREE","TRIAL"].includes(null==G?void 0:G.type);if(e)return C({position:"top",title:A("common:error"),description:A("signup:free-trial-no-crypto"),status:"warning",duration:5e3,isClosable:!0}),T(!1),null;try{let i=e?null:{type:null==D?void 0:D.type,token:null==D?void 0:D.token,how_many_installments:(null==G?void 0:G.how_many_months)||void 0,chosen_period:n?void 0:(null==G?void 0:G.period)||"HALF",coupons:null==D?void 0:D.coupons,add_ons:((null==D?void 0:D.add_ons)||[]).filter(n=>S.includes(null==n?void 0:n.id)),payment_method:"coinbase",return_url:"".concat(window.location.origin,"/crypto-payment-success")},o=await a.Z.payment().pay({country_code:x,...i,conversion_info:{...l}});return o}catch(n){return console.error("Error creating Coinbase charge:",n),T(!1),n}},getChecking=async(n,l)=>{let e=(q||"").trim(),i=[];if(e){let l=e.split(",").map(n=>n.trim()).filter(n=>n.length>0),o=l.map(n=>{let[l,e]=n.split(":"),i=Number(l),o=Number(e),t=Number.isFinite(o)&&o>0?o:1;return{addOnId:i,how_many:t}}).filter(n=>Number.isFinite(n.addOnId)&&n.addOnId>0&&Number.isFinite(n.how_many)&&n.how_many>0),t=Array.isArray(null==n?void 0:n.add_ons)?n.add_ons:[];i=o.map(n=>{var l;let e=t.find(l=>(null==l?void 0:l.id)===n.addOnId),i=null==e?void 0:null===(l=e.service)||void 0===l?void 0:l.id;return{service:Number(i),how_many:n.how_many}}).filter(n=>Number.isFinite(n.service)&&n.service>0&&Number.isFinite(n.how_many)&&n.how_many>0)}let o=Array.isArray(l)?l:$,t={type:"PREVIEW",plans:[null==n?void 0:n.slug],plan_addons:Array.isArray(o)&&o.length>0?o:void 0,coupons:M?[M]:void 0,country_code:x,service_items:i};try{var r;let n=await a.Z.payment().checking(t),{data:l}=n,e=null==l?void 0:null===(r=l.plans)||void 0===r?void 0:r[0],i=encodeURIComponent(null==e?void 0:e.slug),o=await generatePlan(i);if(delete o.id,n.status<400){let n=Array.isArray(null==l?void 0:l.coupons)?l.coupons:[],e=n.map(n=>"string"==typeof n?n:null==n?void 0:n.slug).filter(n=>"string"==typeof n&&n.length>0),i={...l,...o},t={...i,coupons:e,coupons_detail:n,checking_raw:l};return h(t),t}return n}catch(n){return(null==n?void 0:n.status)===400?f(!0):console.err(n),n}},getPaymentMethods=async l=>{try{if(n){m("paymentMethods",!0);let n=await a.Z.payment({academy_id:l,lang:F.locale,country_code:x}).getpaymentMethods();n.status<400&&g(n.data),m("paymentMethods",!1)}}catch(n){console.log(n),m("paymentMethods",!1)}},getSavedCard=async l=>{try{if(n&&l){var e;let n=await a.Z.payment({academy:l}).getSavedCard();if(n.status<400&&(null===(e=n.data)||void 0===e?void 0:e.has_payment_method)){let{data:l}=n;return l}}return null}catch(n){return console.log("Error getting saved card:",n),C({position:"top",title:A("error"),description:A("error-loading-saved-card"),status:"error",duration:5e3,isClosable:!0}),null}},getPriceWithDiscount=(n,l)=>{let e=null==l?void 0:l.discount_value,i=null==l?void 0:l.discount_type;if(e){if("PERCENT_OFF"===i||"HAGGLING"===i){let l=Math.round((n-n*e+Number.EPSILON)*100)/100;return{originalPrice:n,price:l,discount:"".concat(100*e,"%"),discountType:i}}if("FIXED_PRICE"===i)return{originalPrice:n,price:n-e,discount:"$".concat(Math.round(e)),discountType:i}}return{price:n,discount:"0%"}},getSelfAppliedCoupon=async n=>{try{if(n){let{data:l}=await a.Z.payment({plan:n,country_code:x}).verifyCoupon(),e=l[0];l.length>0&&P({...e,plan:n})}}catch(n){console.log(n)}},handleSubscribeToPlan=async n=>{let{slug:l,onSubscribedToPlan:e=()=>{},disableRedirects:i=!1}=n;try{let n=await generatePlan(l);e(n);let o=await getChecking(n),t=await handlePayment({...o,installments:null==o?void 0:o.how_many_months},i);return t}catch(n){return console.error("Error handling subscribe to plan",n),C({position:"top",title:A("alert-message:payment-error"),status:"error",duration:7e3,isClosable:!0}),n}},subscribeFreePlan=async n=>{if(W&&!U&&(null==G?void 0:G.plan_id)){T(!0);try{let l=await handlePayment({...n,installments:null==G?void 0:G.how_many_months},!0);(null==l?void 0:l.status_code)>=400&&(b("error"),N({title:A("transaction-denied"),description:(null==l?void 0:l.detail)||A("payment-not-processed")}));let e=null==l?void 0:l.silent_code;e&&(e===u.oy.CARD_ERROR&&(b("error"),N({title:A("transaction-denied"),description:A("card-declined")})),u.oy.LIST_PROCESSING_ERRORS.includes(e)&&(b("error"),N({title:A("transaction-denied"),description:A("payment-not-processed")})),e===u.oy.UNEXPECTED_EXCEPTION&&(b("error"),N({title:A("transaction-denied"),description:A("payment-error")}))),"FULFILLED"===l.status&&b("success"),T(!1),m("plan",!1)}catch(n){m("plan",!1),C({position:"top",title:A("alert-message:payment-error"),status:"error",duration:7e3,isClosable:!0})}}};return{state:y,stepsEnum:j,isFirstStep:z,isSecondStep:Q,isThirdStep:X,handlePayment,handleCoinbasePayment,getChecking,getPaymentText:()=>{let n=(null==G?void 0:G.type)!=="TRIAL",l=null==G?void 0:G.period;if(n){var e,i,o,t,r,a,d,u,p,c,s,v,_,y,m,h,g,f;if("FINANCING"===l){let n=(null==G?void 0:G.price)*(null==G?void 0:G.how_many_months);return A("info.will-pay-month",{price:null==G?void 0:G.price,qty_months:null==G?void 0:G.how_many_months,total_amount:Math.round(100*n)/100})}if((null==G?void 0:null===(e=G.financing_options)||void 0===e?void 0:e.length)>0&&(null==G?void 0:null===(i=G.financing_options[0])||void 0===i?void 0:i.monthly_price)>0&&(null==G?void 0:null===(o=G.financing_options[0])||void 0===o?void 0:o.how_many_months)===1){let n=(null==G?void 0:null===(s=G.financing_options[0])||void 0===s?void 0:s.monthly_price)*(null==G?void 0:null===(v=G.financing_options[0])||void 0===v?void 0:v.how_many_months);return A("info.will-pay-month",{price:null==G?void 0:null===(_=G.financing_options[0])||void 0===_?void 0:_.monthly_price,qty_months:null==G?void 0:null===(y=G.financing_options[0])||void 0===y?void 0:y.how_many_months,total_amount:Math.round(100*n)/100})}if((null==G?void 0:null===(t=G.financing_options)||void 0===t?void 0:t.length)>0&&(null==G?void 0:null===(r=G.financing_options[0])||void 0===r?void 0:r.monthly_price)>0&&(null==G?void 0:null===(a=G.financing_options[0])||void 0===a?void 0:a.how_many_months)>0){let n=(null==G?void 0:null===(m=G.financing_options[0])||void 0===m?void 0:m.monthly_price)*(null==G?void 0:null===(h=G.financing_options[0])||void 0===h?void 0:h.how_many_months);return A("info.will-pay-monthly",{price:null==G?void 0:null===(g=G.financing_options[0])||void 0===g?void 0:g.monthly_price,qty_months:null==G?void 0:null===(f=G.financing_options[0])||void 0===f?void 0:f.how_many_months,total_amount:Math.round(100*n)/100,next_month:Y})}if((null==G?void 0:null===(d=G.financing_options)||void 0===d?void 0:d.length)>0&&(null==G?void 0:null===(u=G.financing_options[0])||void 0===u?void 0:u.monthly_price)>0&&(null==G?void 0:null===(p=G.financing_options[0])||void 0===p?void 0:p.how_many_months)===0)return A("info.will-pay-now",{price:null==G?void 0:null===(c=G.financing_options[0])||void 0===c?void 0:c.monthly_price});let n={MONTH:A("info.will-pay-per-month",{price:null==G?void 0:G.price}),QUARTER:A("info.will-pay-per-quarter",{price:null==G?void 0:G.price}),HALF:A("info.will-pay-per-half-year",{price:null==G?void 0:G.price}),YEAR:A("info.will-pay-per-year",{price:null==G?void 0:G.price}),ONE_TIME:A("info.one-time-connector",{value:null==G?void 0:G.price})};if(n[l])return n[l]}return""},handleServiceToConsume:n=>{let l=null==n?void 0:n.discount_ratio,e=null==n?void 0:n.bundle_size,i=null==n?void 0:n.price_per_unit,o=null==n?void 0:n.max_items,t=Math.floor(o/e),r=[],a={mentorship:"mentorship sessions",event:"events",compilation:"compilations"};for(let c=1;c<=t;c+=1){let t=c*e;if(t%e==0){var u,p;let s=(0,d._L)({numItems:t,maxItems:o,discountRatio:l,bundleSize:e,pricePerUnit:i,startDiscountFrom:1});r.push({id:c,slug:"".concat(t,"-").concat(null==n?void 0:null===(u=n.serviceInfo)||void 0===u?void 0:u.type),title:"".concat(t," ").concat(a[null==n?void 0:null===(p=n.serviceInfo)||void 0===p?void 0:p.type]),qty:t,pricePerUnit:s.discounted/t,price:s.original,priceText:(0,d.T4)(s.discounted,!0),priceDiscounted:s.discounted,type:"CONSUMABLE"})}}w({...n,list:r})},getPaymentMethods,getSavedCard,getPriceWithDiscount,getSelfAppliedCoupon,applyDiscountCouponsToPlans:(n,l)=>l?n.map(n=>{let{price:e}=n;if(e<1)return n;let i=getPriceWithDiscount(e,l);return{...n,price:i.price,priceText:n.priceText.replace(n.price,i.price),lastPrice:n.priceText}}):n,subscriptionStatusDictionary:L,handleSubscribeToPlan,processPlans,handleSuggestedPlan,validatePlanExistence,subscribeFreePlan,reactivatePlan:(n,l)=>{"CANCELLED"===l&&(b("idle"),F.push("/checkout?plan=".concat(n)))},generatePlan}}}}]);